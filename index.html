<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monthly Budget Tracker</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/1.4.0/chartjs-plugin-annotation.min.js"></script>
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <h1 class="text-xl sm:text-2xl font-bold text-indigo-700">My Budget</h1>
            <div id="userIdDisplay" class="text-xs text-gray-500 hidden">
                ID: <span id="userIdValue" class="font-mono"></span>
            </div>
        </header>

        <div id="loadingSpinner" class="spinner"></div>

        <main id="mainContent" class="hidden">
            <div id="tab-dashboard" class="tab-panel active">
                <div class="summary-header">
                    <div>
                        <p class="text-sm font-medium text-indigo-200">Remaining This Month</p>
                        <p class="text-3xl sm:text-4xl font-bold text-white tracking-tight"><span id="overallRemainingValue">0.00</span> EGP</p>
                    </div>
                    <div class="mt-4">
                        <div class="flex justify-between text-xs text-indigo-100">
                            <span>Spent: <span id="totalSpentValue">0.00</span></span>
                            <span>Budget: <span id="totalBudgetValue">0.00</span></span>
                        </div>
                        <div class="w-full bg-indigo-800/50 rounded-full h-2.5 mt-1 overflow-hidden">
                            <div id="overallProgressBar" class="bg-white h-2.5 rounded-full transition-all duration-500" style="width: 0%;"></div>
                        </div>
                    </div>
                </div>

                <details class="collapsible-section" id="budgetControlContainer">
                    <summary class="collapsible-summary">
                        <span>Budget Options</span>
                        <svg class="chevron" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
                    </summary>
                    <div id="budgetControlPanel" class="collapsible-content flex flex-col sm:flex-row gap-4 items-center">
                        <div class="w-full sm:w-1/2">
                            <label for="budgetSelector" class="block text-sm font-medium text-gray-700 mb-1">Current Budget:</label>
                            <select id="budgetSelector" class="form-input"></select>
                        </div>
                        <div class="w-full sm:w-1/2 flex gap-2 justify-start sm:justify-end sm:pt-6">
                            <button id="addBudgetButton" class="btn bg-green-500 hover:bg-green-600">New</button>
                            <button id="deleteBudgetButton" class="btn bg-red-600 hover:bg-red-700">Delete</button>
                            <button id="editIncomeButton" class="btn bg-gray-500 hover:bg-gray-600">Edit Income</button>
                        </div>
                    </div>
                </details>

                <details class="collapsible-section">
                    <summary class="collapsible-summary">
                        <span>Budget Forecast</span>
                        <svg class="chevron" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
                    </summary>
                    <div class="collapsible-content">
                        <div class="space-y-4">
                            <div>
                                <label for="forecastSelect" class="block text-sm font-medium text-gray-700 mb-1">Forecast for:</label>
                                <select id="forecastSelect" class="form-input"></select>
                            </div>
                            <div id="forecastResult" class="hidden text-center space-y-4 pt-4 border-t border-gray-200">
                                <div id="forecastWarning" class="hidden p-3 text-sm text-red-700 bg-red-100 rounded-lg"></div>
                                <div class="relative h-64"><canvas id="forecastChartCanvas"></canvas></div>
                                <div id="forecastMetrics" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
                            </div>
                        </div>
                    </div>
                </details>

                <details class="collapsible-section">
                    <summary class="collapsible-summary">
                        <span>Manage & Settings</span>
                        <svg class="chevron" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
                    </summary>
                    <div class="collapsible-content">
                        <div class="flex gap-2 flex-wrap">
                            <button id="manageSubcategoriesButton" class="btn bg-cyan-500 hover:bg-cyan-600">Subcategories</button>
                            <button id="managePaymentsButton" class="btn bg-teal-500 hover:bg-teal-600">Payments</button>
                            <button id="manageTypesButton" class="btn bg-gray-500 hover:bg-gray-600">Types</button>
                            <button id="addCategoryModalButton" class="btn btn-purple">Add Category</button>
                            <button id="archiveMonthButton" class="btn bg-indigo-600 hover:bg-indigo-700 mt-2 w-full">Archive Current Month</button>
                        </div>
                    </div>
                </details>

                <h2 class="text-xl font-bold text-gray-800 mt-6 mb-3">Category Spending</h2>
                <div id="categoryDetailsContainer" class="category-container"></div>
            </div>

            <div id="tab-transactions" class="tab-panel">
                <h2 class="text-xl font-bold text-gray-800 mb-4">Transactions</h2>
                <details class="collapsible-section">
                    <summary class="collapsible-summary">
                        <span>Filters & Breakdown</span>
                        <svg class="chevron" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
                    </summary>
                    <div class="collapsible-content">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <div><label for="filterCategory" class="block text-sm font-medium text-gray-700">Category</label><select id="filterCategory" class="form-input mt-1"></select></div>
                            <div><label for="filterPaymentMethod" class="block text-sm font-medium text-gray-700">Payment</label><select id="filterPaymentMethod" class="form-input mt-1"></select></div>
                            <div><label for="filterStartDate" class="block text-sm font-medium text-gray-700">Start Date</label><input type="date" id="filterStartDate" class="form-input mt-1"></div>
                            <div><label for="filterEndDate" class="block text-sm font-medium text-gray-700">End Date</label><input type="date" id="filterEndDate" class="form-input mt-1"></div>
                            <div class="md:col-span-2 flex justify-end"><button id="clearFiltersButton" class="btn bg-gray-600 hover:bg-gray-700 w-full sm:w-auto">Clear Filters</button></div>
                        </div>
                        <div class="flex justify-between items-center mb-2"><h3 class="text-lg font-semibold">Spending Breakdown</h3><select id="transactionPieChartGroup" class="form-input w-auto text-sm"><option value="category">By Category</option><option value="type">By Type</option><option value="subcategory">By Subcategory</option></select></div>
                        <div class="relative h-64 sm:h-80"><canvas id="transactionPieChart"></canvas></div>
                    </div>
                </details>
                <div id="transactionList" class="mt-4 space-y-4"></div>
            </div>

            <div id="tab-history" class="tab-panel">
                <h2 class="text-xl font-bold text-gray-800 mb-4">Archived Budgets</h2>
                <div id="monthlyHistoryList" class="space-y-3"></div>
            </div>

            <div id="tab-chart" class="tab-panel">
                <h2 class="text-xl font-bold text-gray-800 mb-4">Budget History Chart</h2>
                <div id="chartContainer" class="relative h-[50vh] sm:h-96 content-card"></div>
            </div>
        </main>
    </div>

    <button id="addExpenseFab" class="fab-base" title="Add New Expense"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg></button>
    <button id="voiceFab" class="fab-base" title="Start Voice Input"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" x2="12" y1="19" y2="22"/></svg></button>
    
    <nav class="bottom-nav">
        <button class="tab-button active" data-tab="dashboard" aria-label="Dashboard">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
            <span>Dashboard</span>
        </button>
        <button class="tab-button" data-tab="transactions" aria-label="Transactions">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg>
            <span>Transactions</span>
        </button>
        <button class="tab-button" data-tab="history" aria-label="History">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><path d="m18 18-4-4h-4"/><path d="M3 13a9 9 0 1 0 9-9"/></svg>
            <span>History</span>
        </button>
        <button class="tab-button" data-tab="chart" aria-label="Chart">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><path d="m19 9-5 5-4-4-3 3"/></svg>
            <span>Chart</span>
        </button>
    </nav>
    
    <div id="inlineNotification" class="hidden"></div>
    <div id="categoryModalOverlay" class="custom-modal-overlay hidden"></div>
    <div id="transactionModalOverlay" class="custom-modal-overlay hidden"></div>
    <div id="archivedMonthDetailsModalOverlay" class="custom-modal-overlay hidden"></div>
    <div id="confirmModalOverlay" class="custom-modal-overlay hidden"></div>
    <div id="manageItemsModalOverlay" class="custom-modal-overlay hidden"></div>
    <div id="manageSubcategoriesModalOverlay" class="custom-modal-overlay hidden"></div>

    <script type="module" src="main.js"></script>
</body>
</html>
